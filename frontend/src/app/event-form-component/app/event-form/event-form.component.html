<div class="container py-4">
  <form (ngSubmit)="submitForm()" autocomplete="off" class="d-flex flex-column gap-3">

    <h2 class="text-center fw-bold mb-3">Je crÃ©e une activitÃ©</h2>

    <!-- Tag -->
    <div>
      <label class="form-label fw-bold">Tag</label>

      <!-- Tags les plus frÃ©quents -->
      <div class="d-flex flex-wrap gap-2 mb-2">
        <span
          *ngFor="let t of filteredTags"
          (click)="selectTag(t)"
          class="badge px-3 py-2"
          [ngClass]="{
            'bg-warning text-dark': event.tag === t,
            'bg-light border text-dark': event.tag !== t
          }"
          style="cursor: pointer"
        >
          {{ t }}
        </span>
      </div>

      <!-- Barre de recherche -->
      <input
        type="text"
        class="form-control"
        placeholder="Rechercher un tag..."
        [(ngModel)]="searchTag"
        (ngModelChange)="onSearchTagChange()"
      />
    </div>
    <div *ngIf="tagMissingError" class="text-danger small mt-1">
      Vous devez sÃ©lectionner un tag pour votre activitÃ©.
    </div>

    <!-- Description -->
    <div>
      <label class="form-label fw-bold">Description</label>
      <textarea class="form-control" [(ngModel)]="event.description" name="description" rows="2"
        placeholder="Ex: Session libre pour joueurs de tous niveaux" (ngModelChange)="onDescriptionChange()"></textarea>
    </div>
    <div class="d-flex justify-content-between small mt-1">
      <span *ngIf="descriptionError" class="text-danger">La description est obligatoire (10â€“500 caractÃ¨res).</span>
      <span [class.text-danger]="event.description?.length > maxDescriptionLength">
        {{ event.description?.length || 0 }}/{{ maxDescriptionLength }}
      </span>
    </div>

    <!-- Date & Time -->
    <div class="d-flex flex-column flex-md-row gap-3">
      <div>
        <label class="form-label fw-bold">Date</label>
        <input
          class="form-control"
          ngbDatepicker
          name="date"
          [(ngModel)]="event.date"
          #d="ngbDatepicker"
          (click)="d.toggle()"
          [minDate]="minDate"
          placeholder="jj/mm/aaaa"
          (ngModelChange)="onDateOrTimeChange()"
        />
      </div>
      <!-- Heure -->
      <div class="flex-fill">
        <label class="form-label fw-bold">Heure</label>
        <div class="d-flex gap-2 align-items-center">
        <input
          type="time"
          lang="fr"
          class="form-control"
          [(ngModel)]="event.startTime"
          name="startTime"
          [min]="getMinStartTime()"
          required
          (ngModelChange)="onDateOrTimeChange()"
        />
          <span class="align-self-center">â†’</span>
          <input
            type="time"
            lang="fr"
            class="form-control"
            [(ngModel)]="event.endTime"
            name="endTime"
            required
          />
        </div>
      </div>
    </div>
    <div *ngIf="dateOrTimeMissingError" class="text-danger small mt-1">
      La date et lâ€™heure de dÃ©but sont obligatoires.
    </div>
    <div *ngIf="dateInPastError" class="text-danger small mt-1">
      La date et lâ€™heure de dÃ©but doivent Ãªtre dans le futur.
    </div>
    <div *ngIf="timeRangeError" class="text-danger small mt-1">
      Lâ€™heure de fin doit Ãªtre postÃ©rieure Ã  lâ€™heure de dÃ©but.
    </div>

    <!-- Lieu avec autocomplÃ©tion -->
    <div>
      <label class="form-label fw-bold">ğŸ“ Lieu</label>
      <input
        #searchInput
        type="text"
        class="form-control"
        placeholder="Rechercher un lieu (ex: CafÃ© Auguste)"
      />
    </div>
    <!-- Adresse rÃ©cupÃ©rÃ©e automatiquement -->
    <div *ngIf="event.address">
      <label class="form-label mt-2">Adresse dÃ©tectÃ©e</label>
      <input class="form-control" [value]="event.address" readonly />
    </div>
    <div *ngIf="locationError" class="text-danger small mt-1">
      Le lieu est obligatoire. Veuillez sÃ©lectionner un lieu dans la liste.
    </div>

    <!-- Participants -->
    <div>
      <label class="form-label fw-bold d-block">Participants</label>
      <div class="d-flex gap-3">
        <div class="flex-fill">
          <label>Min</label>
          <input type="number" class="form-control" [(ngModel)]="event.minParticipants" name="minParticipants" />
        </div>
        <div class="flex-fill">
          <label>Max</label>
          <input type="number" class="form-control" [(ngModel)]="event.maxParticipants" name="maxParticipants" />
        </div>
      </div>
    </div>
    <div *ngIf="participantRangeError" class="text-danger small mt-1">
      Le nombre maximum de participants doit Ãªtre supÃ©rieur ou Ã©gal au minimum.
    </div>
    <div *ngIf="minParticipantsError" class="text-danger small mt-1">
      Le nombre minimum de participants doit Ãªtre compris entre 2 et 100.
    </div>
    <div *ngIf="maxParticipantsError" class="text-danger small mt-1">
      Le nombre maximum de participants doit Ãªtre compris entre 2 et 100.
    </div>

    <!-- Ã‚ges -->
    <div>
      <label class="form-label fw-bold">Tranche d'Ã¢ge</label>
      <div class="d-flex gap-3">
        <div class="flex-fill">
          <label>Ã‚ge min</label>
          <input type="number" class="form-control" [(ngModel)]="event.minAge" name="minAge" min="13" />
        </div>
        <div class="flex-fill">
          <label>Ã‚ge max</label>
          <input type="number" class="form-control" [(ngModel)]="event.maxAge" name="maxAge" />
        </div>
      </div>
    </div>
    <div *ngIf="ageRangeError" class="text-danger small mt-1">
      L'Ã¢ge maximum doit Ãªtre supÃ©rieur ou Ã©gal Ã  l'Ã¢ge minimum.
    </div>

    <!-- Contraintes de genre -->
    <div>
      <label class="form-label fw-bold">Contraintes</label>
      <select class="form-select" [(ngModel)]="event.genderRequirement" name="genderRequirement">
        <option value="ParitÃ©">â™€ï¸ = â™‚ï¸ Parity</option>
        <option value="Mixte">Mixte</option>
        <option value="Femme">Femmes uniquement</option>
        <option value="Homme">Hommes uniquement</option>
      </select>
    </div>

    <!-- VisibilitÃ© -->
    <div>
      <label class="form-label fw-bold">ğŸ”’ VisibilitÃ© de lâ€™Ã©vÃ©nement :</label>
      <select class="form-select" [(ngModel)]="event.visibility" name="visibility">
        <option value="PUBLIC">â—¯ Public (par dÃ©faut)</option>
        <option value="GROUP">â— PrivÃ© â€“ rÃ©servÃ© Ã  un groupe</option>
      </select>
    </div>

    <!-- Groupe concernÃ© -->
    <div *ngIf="event.visibility === 'GROUP'">
      <label class="form-label fw-bold">Groupe concernÃ© :</label>
      <select class="form-select" [(ngModel)]="event.groupId" name="groupId">
        <option *ngFor="let g of myGroups" [value]="g.id">{{ g.name }}</option>
      </select>
    </div>

    <!-- Ajouter une photo -->
    <div class="border rounded p-3 text-center">
      <strong>â• Ajouter une photo</strong> liÃ©e Ã  lâ€™Ã©vÃ©nement (facultatif)
    </div>

    <!-- Bouton -->
    <button type="submit" class="btn btn-warning w-100 fw-bold" [disabled]="loading">
      <span *ngIf="!loading">CrÃ©er</span>
      <span *ngIf="loading" class="spinner-border spinner-border-sm"></span>
    </button>

    <!-- Message succÃ¨s -->
    <div *ngIf="successMessage" class="alert alert-success text-center">
      âœ… Ã‰vÃ©nement crÃ©Ã© avec succÃ¨s !
    </div>
  </form>
</div>
